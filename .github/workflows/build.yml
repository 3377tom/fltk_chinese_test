name: ğŸš€ OpenCV + FLTK (Win/CUDA/Chinese) è‡ªåŠ¨æ„å»º

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch: # å…è®¸åœ¨ GitHub é¡µé¢æ‰‹åŠ¨è§¦å‘

jobs:
  build_windows:
    # å¿…é¡»ä½¿ç”¨ Windows Runnerï¼Œä¸”éœ€è¦ Visual Studio 2019 å·¥å…·é“¾
    runs-on: windows-latest 

    steps:
      - name: â¬‡ï¸ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: âš™ï¸ æ·»åŠ  MSBuild åˆ° PATH (ç”¨äº CMake/VSæ„å»º)
        uses: microsoft/setup-msbuild@v2

     # å…³é”®æ­¥éª¤ 1ï¼šå®‰è£… CUDA Toolkit (ä¿®æ­£è¯­æ³•)
      - name: â• å®‰è£… CUDA Toolkit 11.2 (ä½¿ç”¨ç¨³å®šAction)
        uses: Jimver/cuda-toolkit@v0.22 # <--- ä¿®æ­£ä¸º Jimver/cuda-toolkit
        with:
          cuda: '11.2'
      
      # åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ„å»ºç›®å½• (åç»­æ­¥éª¤ä¸å˜)
      - name: ğŸ“ é…ç½® CMake
        run: cmake --build build --config Release
        shell: powershell

      # å…³é”®æ­¥éª¤ 3ï¼šä¸Šä¼ æœ€ç»ˆçš„æ„å»ºäº§ç‰©
      - name: ğŸ“¦ ä¸Šä¼  Release æ„å»ºäº§ç‰©
        uses: actions/upload-artifact@v4
        with:
          name: fltk-opencv-release
          path: |
            build/fltk_chinese_test.exe
            # è·¯å¾„æ ¹æ®ä½ çš„é…ç½®ï¼ŒæŒ‡å‘ OpenCV å®‰è£…ç›®å½•ä¸‹çš„ bin æ–‡ä»¶å¤¹
            build/External/OpenCV/Install/x64/vc16/bin/*.dll
            
      # å¯é€‰ï¼šå¦‚æœä½ ä¹Ÿéœ€è¦ Debug ç‰ˆæœ¬
      - name: ğŸ”¨ ç¼–è¯‘é¡¹ç›® (Debug)
        run: cmake --build build --config Debug
        shell: powershell

      - name: ğŸ“¦ ä¸Šä¼  Debug æ„å»ºäº§ç‰©
        uses: actions/upload-artifact@v4
        with:
          name: fltk-opencv-debug
          path: |
            build/fltk_chinese_testd.exe
            build/External/OpenCV/Install/x64/vc16/bin/*d.dll
